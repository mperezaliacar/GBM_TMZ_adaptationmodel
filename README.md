# GBM_TMZ_adaptationmodel

This repository contains the MATLAB implementation of the model of glioblastoma (GBM) adaptation to temozolomide (TMZ), described in detail in [this paper](https://www.sciencedirect.com/science/article/pii/S001048252400951X).

## Table of Contents
- [Description](#description)
- [Installation and usage](#installation-and-usage)
- [Results](#results)
- [Contributing](#contributing)
- [Contact](#contact)

## Description

The repository includes the following folders:

- code: This folder contains the scripts:
    * `parameters.m`: In this script the value of the parameters of the model can be defined
    * `model_simulation.m`:  A script which runs the model using the parameter values specified in `parameters.m`. 
    * `optimisation_stage1.m`: A script that performs optimisation of the parameters related to spheroid growth (stage 1 in the paper) for a model candidate, given initial values of the parameters, and returns the optimal parameters and the values of $\chi^2$ and the Akaike and Bayesian Information Criteria (AIC and BIC) to perform model selection. 
    * `optimisation_stage2.m`: A script that performs optimisation of the parameters related to TMZ response (stage 2 in the paper) for a model candidate, given initial values of the parameters, and returns the optimal parameters and the values of $\chi^2$ and the Akaike and Bayesian Information Criteria (AIC and BIC) to perform model selection. 
    * `objfun_stage1.m`: Auxiliar function that computes the value of the $\chi^2$ objective function for the optimisation (stage 1). 
    * `objfun_stage2.m`: Auxiliar function that computes the value of the $\chi^2$ objective function for the optimisation (stage 2). 
    * `odefun_stage1.m`: Auxiliar function containing the implementation of the ODEs of the model (stage 1).
    * `odefun_stage2.m`: Auxiliar function containing the implementation of the ODEs of the model (stage 2).  
    * `sensitivity_analysis.m`: A script that, given reference results (produced by `model_simulation.m`) and the value of the parameters used to generate them (defined in `parameters.m`), performs a local sensitivity analysis. 
- `data`: This folder contains the experimental data `expDATA.mat`, in a structure named `expDATA` that contains the following fields:
    * `days`: an array with the time points where we have experimental data (measured in days)
    * `mean`: a matrix containing the mean spheroid size, such that the element $ij$ is the mean size for the $i$-th time point and the $j$-th population (where $j=1$ represents the control population, $j=2$ the TMZ-sensitive population and $j=3$ the TMZ-resistant population). 
    * `std`: a matrix with the same structure as `mean` but containing the standard deviations of the data.
    * `N`: an array containing the number of spheroids forming each population.
    * `treatments`: a string array containing the names of each population. 
- `figures`: In this folder the figures generated by the different scripts are stored. 
- `results`: In this folder the result files generated by the different scripts are stored. 


## Installation and usage

1. Clone or download this repository to your local machine (you can use: `git clone https://github.com/mperezaliacar/GBM_TMZ_adaptationmodel.git`).
2. Open MATLAB and navigate to the directory where the repository is located.
3. Run the suitable script according to your needs
    * To run the model, edit `parameters.m` and run `model_simulation.m`
    * To perform a parameter optimisation or evaluate a model candidate, run `optimisation_stage1.m` or `optimisation_stage2.m`, previously setting the initial values accordingly to define the model candidate (the numerical parameters of the optimisation can also be modified at convenience).
    * To perform a local sensitivity analysis (after having run `model_simulation.m` to obtain the reference results), run `sensitivity_analysis.m`.

## Results

- `model_simulation.m`: Once you run this script, a results file named `results_model_simulation.mat` will be created in the results folder. This script contains an array named `tsol` that contains the time points where we have obtained solutions and a matrix named `YSOL` that has dimensions [Time_points x Variables_simulated x Spheroid populations] where the simulated variables are:
    1. Number of live cells
    2. Number of dead cells
    3. TMZ concentration
    4. Level of internal variable (stress)
    5. Level of accumulated internal variable (accumulated stress)
  and the spheroid populations are:
    1. Control
    2. TMZ-sensitive
    3. TMZ-resistant
Besides, four figures will be created in the figures folder, depicting the simulated and experimental results for each of the three spheroid populations (`Results_control.png`, `Results_TMZsens.png` and `Results_TMZres.png`) as well as the TMZ concentration along time with the TMZ threshold (`TMZ_threshold.png`).
- `optimization_stageX.m` (where X can be 1 or 2): Once you run this script, a results file named `results_optimisations_stageX_candidateN.mat' will be created, with N the number of the model candidate that has been defined in the script. This file contains the values of the reference parameters (`xref`), the optimal parameters resulting from the optimisation (`parameters`), and the values of the $\chi^2$ (`CHI2`) and the Akaike and Bayesian Information Criteria (`AIC` and `BIC`). Besides, figures will be created in the figures folder depicting the results of the simulation with the optimal parameters, compared to the experimental results. 
- `sensitivity_analysis.m`: Once you run this script, a results file named `local_sensitivity_analysis_deltaD.mat` will be created, with D the value specified for `delta` in the script. This file contains the value of delta used as well as the values of the sensitivity index along time for each parameter in the matrix `SI`, that has dimensions [Parameters_perturbed x time_points x spheroid_populations]. Besides, it generates three figures (for the sensitive and resistant populations as well as the average of both) in the figures folder, depicting barplots with the values of the sensitivity index for each parameter (`barplot_sensitive.png`, `barplot_resistant.png`, `barplot_average.png`).


## Contributing

If you want to contribute to this project, please follow these steps:

1. Fork the repository.
2. Create a new branch (`git checkout -b feature/new-feature`).
3. Make your changes and commit (`git commit -am 'Add a new feature'`).
4. Push your changes to your GitHub repository (`git push origin feature/new-feature`).
5. Create a new pull request.

## Contact

If you have any questions or suggestions, feel free to contact the author:

- Name: [Marina Perez Aliacar]
- Email: [marina.perez@unizar.es]